
@{
	ViewBag.Title = "Cuestionario";
}

<div>
	<div style="display: inline-block">
		<h2>Cuestionario</h2>
	</div>
	<div class="volverArribaPagina">
		<a href="@Url.Action("Index", "Home")" class="btn btn-primary" Title="Volver al menú">
			<span class="glyphicon glyphicon-chevron-left"></span>
			Volver
		</a>
	</div>
</div>

<div class="panel panel-default" ng-controller="preguntasController">

	<div class="panel-heading">
		<div class="row">
			<div class="col-md-9">
				<form class="form-inline">
					<input type="text" id="busqTextoPregunta" class="form-control" placeholder="Texto pregunta" ng-model="busqTextoPregunta" ng-change="filtrar(false)">
					<label class="control-label" style="padding-left: 1%; font-weight: normal;">Mostrar: </label>
					<input type="checkbox" class="form-control" id="checkMostrar" ng-click="filtrar(true)">
				</form>
			</div>
			<div class="col-md-pull-2">
				<label class="control-label" style="padding-left: 1%;">Preguntas: </label>
				<label class="control-label" style="padding-right: 1%;" ng-bind="filtrados.length"></label>
				<button class="btn btn-primary" ng-click="agregarPregunta()">Agregar Pregunta</button>
			</div>
		</div>
	</div>

	<table id="tablaOrdenTrabajo" class="table table-striped table-bordered table-hover table-condensed">
		<thead>
		<tr class="text-uppercase">
			<th width="40%" class="text-center">Texto</th>
			<th width="10%" class="text-center">Es cerrada</th>
			<th width="12%" class="text-center">Causal rechazo</th>
			<th width="10%" class="text-center">Mostrar</th>
			<th width="10%" class="text-center">Orden</th>
			<th width="18%" class="text-center">Acciones</th>
		</tr>
		</thead>
		<tbody ng-cloak>
		<tr ng-repeat="p in filtrados = (preguntas | filter: filtro) | limitTo:infoPagina.itemsPorPagina:infoPagina.itemsPorPagina*(infoPagina.pagina-1)">
			<td class="celdaGrillaAdmin noEnCelular">
				<span editable-text="p.TextoPregunta" e-name="textoPregunta" e-form="rowform" e-required>
					{{ p.TextoPregunta || '-' }}
				</span>
			</td>
			<td class="celdaGrillaAdmin noEnCelular">
				<a href="#" editable-checkbox="p.EsCerrada" e-name="esCerrada" e-form="rowform" e-title="">
					{{ p.EsCerrada && "Sí" || "No" }}
				</a>
			</td>
			<td class="celdaGrillaAdmin">
				<a href="#" editable-checkbox="p.CausalRechazo" e-name="causalRechazo" e-form="rowform" e-title="">
					{{ p.CausalRechazo && "Sí" || "No" }}
				</a>
			</td>
			<td class="celdaGrillaAdmin">
				<a href="#" editable-checkbox="p.Mostrar" e-name="mostrar" e-form="rowform" e-title="">
					{{ p.Mostrar && "Sí" || "No" }}
				</a>
			</td>
			<td class="celdaGrillaAdmin">
				<span editable-text="p.Orden" e-name="orden" e-form="rowform" e-required>
					{{ p.Orden || '-' }}
				</span>
			</td>
			<td class="celdaGrillaAdmin" style="white-space: nowrap">
				<!-- form -->
				<form editable-form name="rowform" onbeforesave="guardarPregunta($data, p.IdPregunta)" ng-show="rowform.$visible" class="form-buttons form-inline" shown="inserted == p">
					<button type="submit" ng-disabled="rowform.$waiting" class="btn btn-primary">
						Guardar
					</button>
					<button type="button" ng-disabled="rowform.$waiting" ng-click="cancelarPregunta(rowform, p.IdPregunta)" class="btn btn-default">
						Cancelar
					</button>
				</form>
				<div class="buttons" ng-show="!rowform.$visible">
					<button class="btn btn-primary glyphicon glyphicon-pencil" ng-click="rowform.$show()" title="Editar"></button>
					<button class="btn btn-warning glyphicon glyphicon-hand-up" ng-click="cambiarOrden(p.IdPregunta, p.Orden - 1)" title="Subir"></button>
					<button class="btn btn-warning glyphicon glyphicon-hand-down" ng-click="cambiarOrden(p.IdPregunta, p.Orden + 1)" title="Bajar"></button>
					<button class="btn btn-danger glyphicon glyphicon-trash" ng-click="removerPregunta(p.IdPregunta)" title="Eliminar"></button>
				</div>
			</td>
		</tr>
		</tbody>
	</table>
	<div style="text-align:center">
		<uib-pagination ng-show="infoPagina.totalItems > infoPagina.itemsPorPagina" total-items="filtrados.length" boundary-links="true" ng-model="infoPagina.pagina" 
		                items-per-page="infoPagina.itemsPorPagina"></uib-pagination>
	</div>
</div>

@section scripts{
	@Scripts.Render("~/app/services/preguntasServicio.js")
	@Scripts.Render("~/app/controllers/preguntasController.js")
	@Scripts.Render("~/Scripts/Auxiliares/preguntas.js")
}